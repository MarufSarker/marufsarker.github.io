/*************************************************************************
 * Name          : blog_posts_search.js                                  *
 * Purpose       : Implementation of Search Function for Blog Posts      *
 * Author        : Abu Md. Maruf Sarker                                  *
 * Copyright (c) : 2016-Present, Abu Md. Maruf Sarker                    *
 * Website       : https://marufsarker.github.io                         *
 * License       : MIT License (https://opensource.org/licenses/MIT)     *
 *************************************************************************/
function getHTML(e,t){var r=document.createElement(e);for(var a in t){var n=t[a];"innerText"===a?r.appendChild(document.createTextNode(n)):r.setAttribute(a,n)}return r}function emptyDOMElem(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild)}function createSearchResultsHTML(e){if(e.length<=0)emptyDOMElem(finalDOMNode);else{var t=window.store;emptyDOMElem(finalDOMNode);for(var r=0;r<e.length;r++){var a=t[e[r]],n=getHTML("div",{class:"amms-blog-post-search-result-container"}),l=getHTML("h3",{class:"amms-blog-post-search-result-title"}),s=getHTML("a",{class:"amms-blog-post-search-result-link",href:a.url,alt:a.title,title:a.title,innerText:a.title}),i=getHTML("small",{class:"amms-blog-post-search-result-date",innerText:a.date});l.appendChild(s),l.appendChild(i),n.appendChild(l),finalDOMNode.appendChild(n)}}}function displaySearchResults(e){for(var t=[],r=0;r<e.length;r++){var a=e[r].ref;t.indexOf(a)<0&&t.push(a)}createSearchResultsHTML(t)}function searchPost(e){if(lunr){var t=lunr(function(){this.field("id"),this.field("title",{boost:10})});for(var r in window.store)t.add({id:r,title:window.store[r].title});displaySearchResults(t.search(e))}}function clearQuery(){document.forms[searchFormID][searchQueryInputID].value=""}function trimString(e){try{return e.trim()}catch(t){return e.replace(/^\s+|\s+$/gm,"")}}function getQuery(){var e=document.forms[searchFormID][searchQueryInputID].value;e=trimString(e),searchPost(e)}function checkURI(){var e=window.location.search.substring(1).split("&");if(e.length>0)for(var t=0;t<e.length;t++){var r=e[t].split("=");if("query"===r[0]&&r.length>0){var a=trimString(r[1]);initialURIChecked=!0,searchPost(a)}}}function initialURICheck(){!1===initialURIChecked&&checkURI()}var searchFormID="amms-blog-post-search",searchQueryInputID="amms-blog-post-search-box",searchResultsHolderDivID="amms-blog-post-search-results",seacrhResultsClearButton="amms-blog-post-search-clear",initialURIChecked=!1,finalDOMNode=document.getElementById(searchResultsHolderDivID),elemSearchForm=document.getElementById(searchFormID),elemResultsClear=document.getElementById(seacrhResultsClearButton);elemSearchForm.addEventListener&&elemSearchForm.addEventListener("submit",function(e){e.preventDefault(),getQuery()},!1),elemResultsClear.addEventListener&&elemResultsClear.addEventListener("click",function(e){e.preventDefault(),emptyDOMElem(finalDOMNode),clearQuery()},!1),window.addEventListener?window.addEventListener("load",initialURICheck,!1):window.attachEvent&&window.attachEvent("onload",initialURICheck);